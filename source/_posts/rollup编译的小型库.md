---
title: rollupç¼–è¯‘çš„å°å‹åº“
index_img: /posts/90da98cf/rollup-1626491194567.jpg
abbrlink: 7c78b87b
date: 2022-06-30 14:43:40
tags: Rollup
---

## **ğŸ“–é˜…è¯»æœ¬æ–‡ï¼Œä½ å°†:**

1. æ‰‹æŠŠæ‰‹å¸¦ä½ æ­å»ºä¸€ä¸ªæç®€ `npm` åŒ…ï¼ˆ `rollup` + `esbuild` + `ts` ï¼‰ï¼›
2. ä»å·¥ç¨‹ç»“æ„å…¨æ–¹ä½æ€è€ƒ `npm` åŒ…çš„å¼€å‘åŸåˆ™ã€‚
3. å­¦ä¼š `rollup`ã€`esbuild` ç­‰æ–°å…´æ„å»ºå·¥å…·çš„ä½¿ç”¨ï¼›

## **ä¸€ã€å‰ç½®é˜…è¯»ï¼ˆæ¨èï¼‰**

> æœ¬æ–‡ç« ä¸å†èµ˜è¿° `rollup` å’Œ å®˜æ–¹ `rollup` æ’ä»¶çš„ä½¿ç”¨ï¼Œå› æ­¤æœ‰éœ€è¦çš„è¯å»ºè®®å…ˆé˜…è¯»å‰ç½®æ–‡ç« ï¼š

1. è¯´ä¸æ¸…rollupèƒ½è¾“å‡ºå“ª6ç§æ ¼å¼ğŸ˜¥å·®ç‚¹è¢«é„™è§†
2. ä¸€æ–‡å…¥é—¨rollupğŸª€ï¼13ç»„demoå¸¦ä½ è½»æ¾é©¾é©­

å¦‚æœä½ å¯¹ `rollup` å’Œå…¶å®˜æ–¹æ’ä»¶æœ‰äº†ä¸€å®šäº†è§£ï¼Œå¯è·³è¿‡æœ¬èŠ‚æ¨èçš„ç›¸å…³é˜…è¯»ï¼›

## **äºŒã€ç›®æ ‡**

å…ˆåˆ¶å®šä¸€ä¸ªå°ç›®æ ‡ï¼š

> ä»é›¶æ„å»ºä¸€ä¸ªé€šè¿‡ `rollup` æ„å»ºçš„ `npm` åŒ…ï¼›å®ƒå¯å‘å¸ƒã€å¯è°ƒè¯•ã€æ”¯æŒ `TypeScript`ã€èƒ½å¤Ÿé€šè¿‡ `cdn` å¼•å…¥é¡µé¢ã€ä¹Ÿå¯ä»¥é€šè¿‡ `npm` åœ¨é¡¹ç›®é‡Œå®‰è£…å¼•å…¥ã€‚

è¿™ä¸ªç›®æ ‡æœ‰å“ªäº›å…³é”®è¯ï¼Ÿè®©æˆ‘ä»¬æ‹†è§£ä¸€ä¸‹ï¼š

1. æ˜¯ä¸€ä¸ª **å¯å‘å¸ƒ** çš„ `npm` åŒ…ï¼›
2. é€šè¿‡ `rollup` æ„å»ºï¼›
3. æ”¯æŒ **è°ƒè¯•** ï¼›
4. æ”¯æŒ **TypeScript** ;
5. èƒ½é€šè¿‡ **`cdn`** æ–¹å¼å¼•å…¥
6. ä¹Ÿæ”¯æŒé€šè¿‡ `npm` å®‰è£…ï¼›

çœ‹ä¼¼ç®€å•ï¼Œå…¶å®å†…ä¸­è•´å«ç€è®¸å¤šå‰ç«¯ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œè®©æˆ‘ä»¬ä¸€ä¸€æ¢³ç†ï¼›

## **ä¸‰ã€å…¸å‹ `npm` åŒ…çš„ç»“æ„**

æˆ‘ä»¬å‘å¸ƒä¸€ä¸ª `npm` åŒ…æ—¶ï¼Œæˆ‘ä»¬åœ¨å‘å¸ƒä»€ä¹ˆï¼Ÿ

1. ä¸€ä¸ªç”¨æ¥å£°æ˜ `npm` å±æ€§çš„ `package.json` æ–‡ä»¶ï¼›
2. è‹¥å¹²å¯æ‰§è¡Œã€å¯å¼•å…¥çš„æ–‡ä»¶ï¼›

ä»…æ­¤è€Œå·²ã€‚

åªæœ‰ `package.json` æ˜¯ç‰¹æ®Šçš„ï¼Œé™¤æ­¤ä¹‹å¤–çš„ä¸€åˆ‡éƒ½å¯ä»¥è¢«å½’ä¸º â€œè‹¥å¹²æ–‡ä»¶â€ ä¹‹åˆ—ï¼›

æ‰¾ä¸€ä¸ªæœ€å…¸å‹ã€æœ€ç®€å•çš„ `npm` åŒ…æ¥å°è¯æˆ‘ä»¬çš„æƒ³æ³•ï¼Œä½ å¯ä»¥éšä¾¿æ‰¾ä¸ªé¡¹ç›®ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```
npm i the-answer
# ä¼ è¯´ï¼Œæ­¤åº“ä»¥ â€œåŠŸèƒ½ä¸°å¯Œâ€ã€â€œæ¯«æ— ç ´ç»½â€ é—»åäºä¸–
```

ç„¶åæ‰¾åˆ° `node_modules/the-answer` æ–‡ä»¶å¤¹ï¼Œçœ‹çœ‹å…¶é¡¹ç›®ç›®å½•:

![å›¾ç‰‡](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

æ˜¯ä»¥ï¼Œè¦ç†è§£ `npm` åŒ…ï¼Œå¿…é¡»å…ˆä» `package.json` å…¥æ‰‹ï¼Œè€Œä¸€ä¸ªå…¸å‹çš„ `package.json` è‡³å°‘åº”è¯¥å…·å¤‡ä»¥ä¸‹å±æ€§ï¼š

```
{
  "name": "the-answer",
  "version": "1.0.0",
  "description": "description",
  "main": "dist/the-answer.js",
  "files": [
    "dist"
  ]
}
```

ä»¥ä¸Šå†…å®¹åˆ†åˆ«è¡¨ç¤ºï¼š

- `name`: åŒ…å
- `version`: ç‰ˆæœ¬
- `description`: åŒ…æè¿°
- `main`ï¼šå…¥å£
- `files`ï¼šåŒ…å‘å¸ƒæ—¶ï¼Œéœ€è¦å°†å“ªäº›æ–‡ä»¶æ‰“åŒ…ä¸Šä¼ 

ä»¥ä¸Š5ä¸ªå±æ€§ï¼Œè¶³ä»¥æ”¯æ’‘ä¸€ä¸ª `npm` åŒ…çš„å‘å¸ƒï¼Œä½†åç»­æˆ‘ä»¬å¯èƒ½è¿˜ä¼šç”¨åˆ°æ›´å¤šï¼Œæ­¤æ—¶ï¼Œè¯·å…ˆè®°ä½å®ƒä»¬ï¼›

é‚£ä¹ˆå…¶ä»–æ–‡ä»¶å‘¢ï¼Ÿ

â€œåè®®â€ å’Œ â€œæ–‡æ¡£â€ å¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œä½†æ˜¯ â€œæ„å»ºç‰©â€ é€šå¸¸éš¾é€ƒ â€œæ„å»ºâ€ è¿™ä¸€è¿‡ç¨‹ã€‚

`rollup` æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼›

## **å››ã€ `rollup` çš„æœ€ç®€ç”¨æ³•**

## **4.1 å®‰è£… `rollup`**

æ‰§è¡Œè„šæœ¬ï¼š

```
npm i -D rollup
# or
yarn add -D rollup
```

## **4.2 åˆ›å»º `rollup.config.js`**

> `rollup.config.js` æ˜¯ `rollup` é»˜è®¤çš„é…ç½®æ–‡ä»¶

åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œï¼Œæœ€ç®€å•çš„é…ç½®è«è¿‡äºï¼š

- é…ç½®å…¥å£æ–‡ä»¶
- é…ç½®è¾“å‡ºè·¯å¾„&æ ¼å¼

```
export default {
  input: path.resolve(__dirname, './src/index.ts'),
  output: [
    {
      dir: path.resolve(__dirname, 'dist/esm'),
      format: 'esm', // é€šè¿‡esmæ ¼å¼è¾“å‡º
    }
  ]
}
```

## **4.3 ç¼–å†™æ„å»ºè„šæœ¬**

åœ¨ `package.json` æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```
{
  ...,
  "scripts": {
    "build": "rollup -c"
  }
}
```

ç¼–å†™å®Œä¸Šé¢è„šæœ¬åï¼Œåªéœ€è¦æ‰§è¡Œï¼š`npm run build`ï¼Œå°±èƒ½æˆåŠŸå®Œæˆä¸€ä¸ªæœ€ç®€å•çš„ `rollup` æ„å»ºäº†ã€‚

ä½†è¿™è¿˜è¿œè¿œä¸å¤Ÿã€‚

## **äº”ã€æ¢³ç†ï¼šæ„å»ºè¿‡ç¨‹åº”è¯¥è¾“å‡ºä»€ä¹ˆï¼Ÿ**

> æ„å»ºæ˜¯ä¸ºäº†æœ‰è¾“å‡ºï¼Œè¾“å‡ºæ˜¯ä¸ºäº†ç»™å®¢æˆ·ä½¿ç”¨ã€‚

å› æ­¤ï¼Œå½“æˆ‘ä»¬æ„å»ºæ—¶ï¼Œåº”è¯¥ç‡å…ˆè€ƒè™‘å®¢æˆ·ä¼šåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨æˆ‘ä»¬çš„åº“ã€‚

ï¼ˆå“ªæ€•æ²¡æœ‰äººçœŸçš„ç”¨ï¼Œä½†æˆ‘ä»¬å¾—å‡è£…è‡ªå·±çš„åº“ä¼šéå¸¸å—æ¬¢è¿ï¼Œä¸æ˜¯å—ï¼ŸğŸ¤£ï¼‰

æœ€å¸¸è§çš„ä¸‰ç§æƒ…å†µï¼š

- åœ¨æ„å»ºå·¥å…·ä¸­å¼•å…¥ï¼ˆ`esm`ï¼‰
- åœ¨é¡µé¢ä¸­ç›´æ¥å¼•å…¥ï¼ˆ`umd`ï¼‰
- åœ¨`nodejs` ç¯å¢ƒä¸­ä½¿ç”¨ (`cjs`)

è€Œæœ¬æ–‡çš„ä¸»è¦ç›®æ ‡ä¸æ¶‰åŠ `nodejs` ç¯å¢ƒï¼Œå› æ­¤æš‚æ—¶ä¸è€ƒè™‘ `cjs` è¾“å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥è¾“å‡ºè‡³å°‘ä¸¤ç§æ ¼å¼ï¼š

1. `esm`
2. `umd`

å…³äºä»¥ä¸Šæ ¼å¼çš„åŒºåˆ«ï¼Œä»¥åŠæ€ä¹ˆè¾“å‡ºï¼Œå‰ç½®é˜…è¯»æ¨èã€Šè¯´ä¸æ¸…rollupèƒ½è¾“å‡ºå“ª6ç§æ ¼å¼ğŸ˜¥å·®ç‚¹è¢«é„™è§†ã€‹é‡Œæœ‰è¯¦ç»†ä»‹ç»ï¼›

é€šè¿‡å‚è€ƒç›®å‰å¼€æºç¤¾åŒºçš„å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å‘ç°ï¼Œé€šå¸¸ä¸€ä¸ªå¼€æºåº“çš„ `esm` äº§å‡ºç‰©ï¼Œå¹¶ä¸æ˜¯å’Œ `rollup` é»˜è®¤è¡Œä¸ºé‚£æ ·â€œæŠŠæ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª `index.esm.js`â€ï¼Œè€Œæ˜¯ï¼š

**åªç¼–è¯‘ï¼Œä¸æ‰“åŒ…**ï¼›ï¼ˆè¿™æ ·å°±èƒ½å®Œç¾æ”¯æŒæŒ‰éœ€å¼•å…¥äº†ï¼‰

![å›¾ç‰‡](rollup%E7%BC%96%E8%AF%91%E7%9A%84%E5%B0%8F%E5%9E%8B%E5%BA%93/640)

æ˜¯çš„ï¼Œæ–‡ä»¶ç»“æ„ä¾ç„¶å’Œæºç ç»“æ„ä¿æŒä¸€è‡´ï¼Œåªæ˜¯å°† `TypeScript` ç¼–è¯‘ä¸º `javascript`ï¼›

è®°ä½è¿™ä¸ªç›®æ ‡ï¼Œå®ƒå¾ˆé‡è¦ï¼›

## **å…­ã€ç¼–è¯‘ `TS` å“ªå®¶å¼ºï¼Ÿ**

> è™½ç„¶æœ‰ææ¡ˆè®© `ts` æˆä¸ºä¸‹ä¸€ä»£çš„æµè§ˆå™¨è¯­è¨€ï¼Œä½†è¿™åªæ˜¯è¿˜æœªåˆ°æ¥çš„æœªæ¥ã€‚

å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çš„åº“æ˜¯ `TypeScript` ç¼–å†™çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å‘å¸ƒä¹‹å‰ï¼Œä¸€å®šéœ€è¦å°†å…¶ç¼–è¯‘ä¸º `javascript` ç±»å‹ã€‚

é‚£ä¹ˆï¼Œåº”è¯¥æ€ä¹ˆç¼–è¯‘å‘¢ï¼Ÿ

ç¤¾åŒºé‡Œç›®å‰çš„ä¸»æµæ–¹æ¡ˆæœ‰ä¸‰ç±»ï¼š

a. `TypeScript` https://www.npmjs.com/package/typescript

b. `Esbuild` https://esbuild.github.io/

c. `Babel` https://babeljs.io/

é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼šhttps://juejin.cn/post/7083298517753528334 çš„å¯¹æ¯”åˆ†æï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼š

`ã€cã€‘` æ¯” `ã€aã€‘` æ”¯æŒçš„è¯­è¨€æ›´ä¸°å¯Œã€ç¼–è¯‘é€Ÿåº¦æ›´å¿«ï¼›ä½†æ˜¯ `.d.ts` è¿˜æ˜¯æ¨èé€šè¿‡ `ã€aã€‘` ä¸­çš„ `tsc` ç¼–è¯‘ç”Ÿæˆï¼›

é‚£ä¹ˆ `ã€bã€‘` é€‰é¡¹ `Esbuild` å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼š**é€Ÿåº¦æ›´å¿«** ï¼

æ‰€ä»¥ï¼Œæˆ‘åšå‡ºäº†å¦‚ä¸‹é€‰æ‹©ï¼š

- ä½¿ç”¨ `esbuild` è¿›è¡Œ `ts => js` çš„ç¼–è¯‘
- ä½¿ç”¨ `TypeScript` è¿›è¡Œ `.d.ts` æ–‡ä»¶çš„ç¼–è¯‘ï¼›

## **ä¸ƒã€ç¼–è¯‘æˆ `esm` æ ¼å¼**

æ•´ä¸ªæ„å»ºè¿‡ç¨‹æ¢³ç†æ¸…æ¥šåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®é‡ŒåŠ å…¥å¦‚ä¸‹ä¾èµ–ï¼š

```
npm i typescript esbuild rollup-plugin-esbuild --save-dev
```

é™¤äº†ä»¥ä¸Šè¿™äº›ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å¸¸è§„ `rollup` æ’ä»¶ä¸åœ¨æ­¤èµ˜è¿°ï¼›

åˆ›å»ºæ–‡ä»¶ï¼š`rollup.esm.config.js`

```
export default {
  input: path.resolve(__dirname, './src/index.ts'),
  output: [
    {
      dir: path.resolve(__dirname, 'dist/esm'),
      format: 'esm',
    }
  ],
  // å…³é”®å±æ€§ï¼Œåªæœ‰å°†å…¶è®¾ç½®ä¸º `true` æ‰èƒ½ä¿è¯åªç¼–è¯‘ã€ä¸æ‰“åŒ…
  preserveModules: true,
  plugins: [
    esbuild({
      target: 'es2018'
    }),
    nodeResolve(),
    json(),
  ],
  // åœ¨ `esm` æ„ä»¶ä¸­ï¼Œ`external` éå¸¸é‡è¦ï¼Œé¡¹ç›®çš„ `dependencies` é‡Œçš„å†…å®¹ç†åº”éƒ½åœ¨æ­¤åˆ—
  external: ['gsap']
};
```

ç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼š

```
{
  "scripts": {
    "build:esm": "rollup -c rollup.esm.config.js",
    "postbuild:esm": "tsc  --emitDeclarationOnly --declaration --project ts.config.json --outDir dist/esm",
  }
}
```

è§£é‡Šä¸€ä¸‹ï¼Œ`postbuild:esm` æ˜¯ `build:esm` è„šæœ¬çš„åç½®é’©å­ï¼Œå½“ `build:esm` æ‰§è¡Œå®Œæˆåä¼šè‡ªåŠ¨æ‰§è¡Œ `postbuild:esm`ï¼›

æ‰§è¡Œè„šæœ¬ï¼š

```
npm run build:esm
```

å¯ä»¥ç¼–è¯‘å‡ºå¦‚ä¸‹æ•ˆæœçš„ä»£ç ï¼š

![å›¾ç‰‡](rollup%E7%BC%96%E8%AF%91%E7%9A%84%E5%B0%8F%E5%9E%8B%E5%BA%93/640)

åŸºæœ¬æ»¡è¶³æˆ‘ä»¬å¯¹ `esm` æ ¼å¼ç¼–è¯‘äº§å‡ºçš„è¦æ±‚ã€‚

## **å…«ã€ç¼–è¯‘ `umd` æ ¼å¼**

å’Œ `esm` æ ¼å¼çš„ç¼–è¯‘è¦æ±‚ä¸åŒï¼Œ`umd` æ ¼å¼æ›´å¤šçš„è¢«ç”¨åœ¨ `cdn` åŠ è½½ã€‚

å› æ­¤ï¼š

- æ„å»ºç‰©ä¸ä»…éœ€è¦ç¼–è¯‘ï¼Œè¿˜éœ€è¦æ‰“åŒ…
- æ— éœ€ `.d.ts` æ–‡ä»¶

åˆ›å»º `rollup.umd.config.js`:

```
export default {
  input: path.resolve(__dirname, './src/index.ts'),
  output: [
    {
      file: path.resolve(__dirname, 'dist/umd/index.js'),
      format: 'umd',
      // è¿™ä¸ªnameå±æ€§éå¸¸é‡è¦ï¼Œæ˜¯é€šè¿‡ cdn å¼•å…¥åï¼ŒæŒ‚è½½åˆ° windowä¸Šçš„å±æ€§å
      name: 'rain'
    }
  ],
  plugins: [
    esbuild({
      // ä¸ºäº†åº”å¯¹ umd ç›´æ¥åŠ è½½åˆ°æµè§ˆå™¨é‡Œï¼Œæ„å»ºç›®æ ‡éœ€è¦è®¾å®šå¾—å…¼å®¹æ€§æ›´å¼º
      target: 'es2015'
    }),
    // éœ€è¦babel plugin
    babel({
      presets: ['@babel/preset-env'],
      exclude: 'node_modules/**',
      babelHelpers: 'bundled'
    }),
    nodeResolve(),
    json(),
    commonjs()
  ],
};
```

ç¼–å†™è„šæœ¬ï¼š

```
{
  "scripts": {
    "build:umd": "rollup -c rollup.umd.config.js",
  }
}
```

æ‰§è¡Œè„šæœ¬ `npm run build:umd` å³å¯å®Œæˆ `umd` æ ¼å¼çš„ç¼–è¯‘ã€‚

å®Œæˆ `esm` å’Œ `umd` çš„ç¼–è¯‘åï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸‹ï¼š

**å¦‚ä½•æ‹¥æœ‰ä¸€ä¸ªè‰¯å¥½çš„å¼€å‘è°ƒè¯•ç¯å¢ƒå‘¢ï¼Ÿ**

## **ä¹ã€`umd` æ„å»ºç‰©çš„è°ƒè¯•**

`rollup` çš„å‘½ä»¤è¡Œæ”¯æŒå‚æ•° `-w` ï¼ˆå’Œ `--watch` ç­‰ä»·ï¼‰ï¼Œå…¶å«ä¹‰æ˜¯ç›‘å¬æºæ–‡ä»¶çš„å˜åŠ¨ï¼Œå½“æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ç«‹åˆ»æ›´æ–°æ–‡ä»¶ï¼›

è¿™å¬èµ·æ¥å’Œ `webpack` çš„ `hrm` ç±»ä¼¼ã€‚

å› æ­¤ï¼Œ`umd` ç¯å¢ƒä¸‹æ„å»ºç‰©çš„è°ƒè¯•æ€è·¯ä¾¿å‡ºæ¥äº†ï¼š

- åˆ›å»ºæ–‡ä»¶ï¼š`examples/base/index.html`
- åœ¨ `index.html`é‡Œå¼•å…¥ `dist/umd/index.js`
- èµ·ä¸€ä¸ª `http` é™æ€æœåŠ¡ä»¥ä¾¿è®¿é—® `index.html` é¡µé¢

è¿™å°±æ˜¯æœ€ç®€å•çš„å‰ç«¯è°ƒè¯•é€»è¾‘ã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸‰ä¸ªå·¥å…·ï¼š

1. `cross-env` å·¥å…·åº“
   é€šè¿‡ `cross-env`ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°è·¨å¹³å°åœ°è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚:

```
cross-env NODE_ENV=production
```

å¯ä»¥æŠŠ `process.env.NODE_ENV` è®¾ç½®æˆ `production`ï¼Œè¿™å¯¹æˆ‘ä»¬çš„åŒºåˆ† â€œè°ƒè¯•â€ ä¸ â€œæ„å»ºâ€ å…·æœ‰éå¸¸å¤§çš„å¸®åŠ©ï¼Œ

1. `rollup-plugin-serve` æ’ä»¶
   è¿™æ˜¯ä¸€ä¸ª `rollup` æ’ä»¶ï¼›
   é€šè¿‡è¿™ä¸ªæ’ä»¶ï¼Œä½ å¯ä»¥ï¼š

- åœ¨å›ºå®šç«¯å£å¯åŠ¨ `http` é™æ€æœåŠ¡
- æŒ‡å®šè¯¥ç«¯å£çš„ `root` æ–‡ä»¶å¤¹
- æŒ‡å®šæµè§ˆå™¨é»˜è®¤æ‰“å¼€é¡µé¢ï¼Œå¹¶å¯ä»¥æŒ‡å®šç›´æ¥è®¿é—®æŸä¸ªè·¯ç”±

1. `rollup-plugin-livereload` æ’ä»¶
   è¿™ä¹Ÿæ˜¯ä¸€ä¸ª `rollup` æ’ä»¶ï¼›
   é€šè¿‡è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥ç›‘å¬æŸä¸ªæ–‡ä»¶å¤¹ï¼Œå½“é‡Œé¢çš„æ–‡ä»¶å‘ç”Ÿå˜åŠ¨åï¼Œåˆ·æ–°é¡µé¢ã€‚

ä½¿ç”¨ä»¥ä¸Šä¸‰ä¸ªå·¥å…·ï¼Œå¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š

```
const isProduction = process.env.NODE_ENV === 'production'
const pluginsWithEnv = isProduction ? [] : [serve({
  open: true,
  openPage: '/base/',
  port: 10001,
  contentBase: ['dist', 'examples']
}), livereload('dist/umd')]

// ç„¶åé€šè¿‡ ...pluginsWithEnv æŠŠé…ç½®ç»“æ„åˆ° rollupçš„plugins é‡Œé¢å»
```

å¹¶æ·»åŠ è„šæœ¬ï¼š

```
{
  "scripts": {
    "dev:umd": "cross-env NODE_ENV=development rollup -w -c rollup.umd.config.js"
  }
}
```

å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼šæ‰§è¡Œ `npm run dev:umd` å°±èƒ½æ­£å¸¸æ‰“å¼€é¡µé¢ï¼Œä»¥åŠå®Œæˆè°ƒè¯•äº†ã€‚

## **åã€`esm` æ„å»ºç‰©çš„è°ƒè¯•**

ç›¸æ¯”äº `umd` é‚£ç®€å•çš„è°ƒè¯•ç»“æ„ï¼Œ`esm` é€šå¸¸æƒ…å†µä¸‹éœ€è¦ä¾èµ–æ„å»ºå·¥å…·ï¼Œäº‹æƒ…å°±å˜å¾—å¤æ‚èµ·æ¥äº†ã€‚

æˆ‘çš„é€‰æ‹©æ˜¯ **åœ¨é¡¹ç›®é‡Œå†…ç½®ä¸€ä¸ªåŸºäº `webpack/vite` çš„é¡¹ç›®** ï¼›

### 10.1 ç”¨ `vue-cli` æ–°å¢é¡¹ç›®

å…ˆå®‰è£… `vue-cli`ï¼Œè§ vue-cli å®˜ç½‘

ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```
cd examples
vue create vue3
```

### 10.2 `import` æ„å»ºç‰©

åœ¨ `vue3` é¡¹ç›®ä¸­é€šè¿‡ç›¸å¯¹è·¯å¾„å¼•ç”¨ `esm` æ„å»ºç‰©ï¼Œå¼•å…¥æ–¹å¼å¦‚ä¸‹ï¼š

```
import xx from '../../../'
```

æ³¨æ„ï¼Œæ­¤å¤„ä¸éœ€è¦æŒ‡å®šåˆ°æŸä¸ª `js` æ–‡ä»¶ï¼Œæ˜¯å› ä¸ºè¦é€šè¿‡ `esm` çš„å¯¼å…¥æ–¹å¼ï¼Œé€šè¿‡å‘½ä¸­é¡¹ç›®çš„ `package.json`ï¼Œé€šè¿‡ `exports`ã€`main`ã€`module` ç­‰å±æ€§å‘½ä¸­å®ƒè¯¥å‘½ä¸­çš„å…¥å£æ–‡ä»¶ã€‚

### 10.3 ç¼–å†™è„šæœ¬

ç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼š

```
{
  "scripts": {
    "serve:vue3": "cd ./examples/vue3 && yarn && yarn serve",
    "watch:esm": "cross-env NODE_ENV=development rollup -w -c rollup.esm.config.js",
  }
}
```

å¦‚æœåˆ†åˆ«è¿è¡Œ `npn run watch:esm` å’Œ `npm run serve:vue3`ï¼Œå°±èƒ½æˆåŠŸè¿è¡Œä¸€ä¸ª `vue3` é¡¹ç›®ï¼Œå¹¶æˆåŠŸè¿›è¡Œè°ƒè¯•ã€‚

### 10.4 å¹¶è”ä¸¤ä¸ªè„šæœ¬

å› ä¸º `serve:vue3` å’Œ `watch:esm` è¿™ä¸¤ä¸ªè„šæœ¬éƒ½æ˜¯ä¼šå¯¼è‡´å‘½ä»¤è¡Œçš„å‘½ä»¤ï¼Œå› æ­¤å¦‚æœä½ è¿™æ ·å†™ä¸€ä¸ªè„šæœ¬ï¼š

```
npn run watch:esm && npm run serve:vue3
```

é‚£ä¹ˆ **åè€…æ°¸è¿œä¸ä¼šæ‰§è¡Œ**ã€‚

å› æ­¤ï¼Œä¸¤è€…å¿…é¡»åŒæ—¶æ‰§è¡Œã€‚

å†æ¨èä¸€ä¸ªå°å·¥å…·ï¼š`npm-run-all` https://www.npmjs.com/package/npm-run-all

æœ‰äº†ä»¥ä¸Šè¿™ä¸ªå·¥å…·ï¼Œä½ å¯ä»¥è½»æ˜“çš„ä¸²è¡Œæˆ–è€…å¹¶è¡Œå„ç§è„šæœ¬ã€‚

æ­¤å¤„åªéœ€è¦å†æ–°å¢ä¸€ä¸ªè„šæœ¬ï¼š

```
{
  "scripts": {
    "dev:esm": "run-p watch:esm serve:vue3",
  }
}
```

è¿™æ ·å°±å¯ä»¥å¼‚æ­¥åŒæ—¶æ‰§è¡Œä¸¤ä¸ªè„šæœ¬äº†ã€‚

## **åä¸€ã€å¼€å‘ & å‘å¸ƒ**

å®Œæˆäº†ä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ï¼Œä½ å°±å¯ä»¥å¼€å§‹å®‰å¿ƒå¼€å‘è„šæœ¬äº†ï¼Œæ— è®ºæ˜¯ â€œæ„å»ºâ€ æŠ‘æˆ–æ˜¯ â€œè°ƒè¯•â€ï¼Œç›®å‰éƒ½å·²ç»éå¸¸æ¸…æ™°äº†ã€‚

å¯¹äº `rollup.js` åœ¨ä¸€ä¸ªå°å‹å‰ç«¯å¼€æºé¡¹ç›®ä¸­åº”è¯¥å¦‚ä½•ä½¿ç”¨ï¼Œä¹Ÿæ¸æ¸æ‘¸æ¸…äº†è„‰ç»œã€‚

ç­‰å¼€å‘å®Œé¡¹ç›®ï¼Œåˆ™éœ€è¦è€ƒè™‘å‘å¸ƒçš„è¿‡ç¨‹ã€‚

æ‰§è¡Œä»¥ä¸‹è¿‡ç¨‹

```
npm version patch 
```

é¡¹ç›®ç¼–å·ä¼šè‡ªåŠ¨ä» `0.0.1` å‡çº§ä¸º `0.0.2`ã€‚

å†æ‰§è¡Œï¼š

```
npm login
npm publish
```

å°±èƒ½æˆåŠŸå‘å¸ƒä½ çš„å¼€æºåº“äº†ã€‚

## **åäºŒã€æ–‡ç« æºç ï¼ˆä¾›å‚è€ƒï¼‰**

å‚è§ï¼šhttps://github.com/zhangshichun/rainy-window